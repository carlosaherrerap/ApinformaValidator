<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin ‚Äî Tokenizer Huancayo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- VISTA DE LOGIN -->
    <div id="loginView" class="login-wrap">
        <div class="login-card">
            <h2>üîê Admin Panel</h2>
            <p>Tokenizer Huancayo</p>
            <div id="login-fields">
                <div class="mb-3">
                    <input type="text" id="login-user" class="form-control" placeholder="Username">
                </div>
                <div class="mb-3">
                    <input type="password" id="login-pass" class="form-control" placeholder="Password">
                </div>
                <button class="btn-accent" onclick="doLogin()">Ingresar</button>
            </div>
            
            <div id="mfa-fields" class="hidden">
                <p class="small text-muted">Se ha enviado un c√≥digo a su WhatsApp</p>
                <div class="mb-3">
                    <input type="text" id="login-otp" class="form-control" placeholder="C√≥digo de 6 d√≠gitos">
                </div>
                <button class="btn-accent" onclick="verifyOTP()">Verificar C√≥digo</button>
                <button class="btn-link btn-sm mt-2" style="color:var(--muted);text-decoration:none;" onclick="cancelMFA()">‚Üê Regresar</button>
            </div>

            <div id="login-error" style="color:var(--danger);text-align:center;font-size:.8rem;margin-top:10px;"></div>
        </div>
    </div>

    <!--  VISTA DE DASHBOARD   -->
    <div id="dashView" class="hidden">
        <div class="topbar">
            <h1>‚ö° Tokenizer Huancayo ‚Äî Admin</h1>
            <div class="user-info">
                <img id="top-photo" class="user-profile-img" src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
                    onclick="showSection('profile')" title="Mi Perfil">
                <span id="top-username">admin</span>
                <span class="badge-role" id="top-role">ADMIN</span>
                <button class="btn-sm-action" onclick="logout()">Salir</button>
            </div>
        </div>

        <div class="sidebar">
            <a href="#" id="nav-stats" class="active" onclick="showSection('stats')">üìä Dashboard</a>
            <a href="#" id="nav-clients" onclick="showSection('clients')">üë• Clientes</a>
            <a href="#" id="nav-whatsapp" onclick="showSection('whatsapp')">üí¨ WhatsApp Master</a>
            <a href="#" id="nav-users" onclick="showSection('users')">‚öôÔ∏è Usuarios</a>
            <a href="#" id="nav-profile" onclick="showSection('profile')" style="margin-top: auto;">üë§ Mi Perfil</a>
        </div>

        <div class="content">
            <!-- seccion de stats -->
            <div id="sec-stats">
                <h5 style="margin-bottom:18px;">Dashboard</h5>
                <div class="stat-grid">
                    <div class="stat-card accent">
                        <div class="value" id="s-total">-</div>
                        <div class="label">Total Clientes</div>
                    </div>
                    <div class="stat-card success">
                        <div class="value" id="s-ok">-</div>
                        <div class="label">Completos</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="value" id="s-proc">-</div>
                        <div class="label">En Proceso</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="s-24h">-</div>
                        <div class="label">√öltimas 24h</div>
                    </div>
                </div>
                <div class="stat-grid">
                    <div class="stat-card success">
                        <div class="value" id="s-tv">-</div>
                        <div class="label">Tokens Validados</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="value" id="s-tx">-</div>
                        <div class="label">Cancelados</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="value" id="s-te">-</div>
                        <div class="label">Expirados</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="s-tp">-</div>
                        <div class="label">Pendientes</div>
                    </div>
                </div>
            </div>

            <!-- seccion de clientes -->
            <div id="sec-clients" class="hidden">
                <div class="panel">
                    <div class="panel-title">
                        <span>üë• Clientes Registrados</span>
                        <input type="text" class="search-bar" id="client-search" placeholder="Buscar..."
                            oninput="searchClients()">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Documento</th>
                                <th>Nombres</th>
                                <th>Celular</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="clients-body"></tbody>
                    </table>
                    <div class="pagination-bar">
                        <span id="page-info">P√°gina 1</span>
                        <div>
                            <button onclick="changePage(-1)">‚Üê Anterior</button>
                            <button onclick="changePage(1)">Siguiente ‚Üí</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WHATSAPP MASTER SECTION -->
            <div id="sec-whatsapp" class="hidden">
                <h5 style="margin-bottom:18px;">Configuraci√≥n WhatsApp Master</h5>
                <div class="panel">
                    <div class="panel-title">Estado de Conexi√≥n</div>
                    <div class="d-flex align-items-center gap-3 mb-4">
                        <div id="wa-status-badge" class="badge-status badge-fail">DESCONECTADO</div>
                        <button class="btn-sm-action" id="btn-wa-start" onclick="startWhatsApp()">Iniciar
                            Conexi√≥n</button>
                        <button class="btn-danger-action hidden" id="btn-wa-stop" onclick="logoutWhatsApp()">Cerrar
                            Sesi√≥n</button>
                    </div>

                    <div id="wa-qr-container" class="text-center hidden">
                        <p class="text-muted small">Escanee el c√≥digo QR con su aplicaci√≥n de WhatsApp</p>
                        <div class="qr-container">
                            <img id="wa-qr-img" style="width: 250px; height: 250px;" src="">
                        </div>
                        <div id="wa-qr-loading" class="qr-placeholder">Cargando QR...</div>
                    </div>

                    <div id="wa-connected-msg" class="hidden text-center p-4">
                        <div style="font-size: 3rem; color: var(--success);">‚úÖ</div>
                        <p class="mt-3">WhatsApp est√° actualmente enlazado y listo para enviar tokens.</p>
                    </div>
                </div>
            </div>

            <!-- seccion de usuarios -->
            <div id="sec-users" class="hidden">
                <div class="panel">
                    <div class="panel-title">
                        <span>‚öôÔ∏è Gesti√≥n de Usuarios</span>
                        <button class="btn-sm-action" onclick="showCreateUser()">+ Crear Usuario</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Foto</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Rol</th>
                                <th>Ver Stats</th>
                                <th>Ver Tokens</th>
                                <th>Activo</th>
                            </tr>
                        </thead>
                        <tbody id="users-body"></tbody>
                    </table>
                </div>
                <!-- Create user form -->
                <div id="create-user-form" class="panel hidden">
                    <div class="panel-title">Crear Nuevo Usuario</div>
                    <div class="row g-2 mb-2">
                        <div class="col-4"><input type="text" id="new-username" class="form-control"
                                placeholder="Username"></div>
                        <div class="col-4"><input type="password" id="new-password" class="form-control"
                                placeholder="Password"></div>
                        <div class="col-4"><input type="email" id="new-email" class="form-control" placeholder="Email">
                        </div>
                    </div>
                    <div class="row g-2">
                        <div class="col-4">
                            <select id="new-role" class="form-control">
                                <option value="2">OPERATOR</option>
                                <option value="3">VIEWER</option>
                            </select>
                        </div>
                        <div class="col-4"><button class="btn-accent" onclick="createUser()">Crear</button></div>
                    </div>
                </div>
            </div>

            <!-- seccion de perfil -->
            <div id="sec-profile" class="hidden">
                <h5 style="margin-bottom:18px;">Mi Perfil</h5>
                <div class="panel" style="max-width: 500px;">
                    <div class="text-center mb-4">
                        <img id="profile-photo" class="profile-photo-edit"
                            src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
                        <div class="mt-2">
                            <h6 id="profile-username" class="mb-0">admin</h6>
                            <span id="profile-role" class="small text-muted">ADMIN</span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small text-muted text-uppercase">Correo Electr√≥nico</label>
                        <input type="email" id="edit-email" class="form-control" placeholder="correo@ejemplo.com">
                    </div>
                    <div class="mb-3">
                        <label class="form-label small text-muted text-uppercase">URL Foto de Perfil</label>
                        <input type="text" id="edit-photo" class="form-control" placeholder="https://...">
                    </div>

                    <hr class="border-secondary opacity-25">
                    <p class="small text-muted mb-3">Cambiar Contrase√±a (opcional)</p>

                    <div class="mb-3">
                        <input type="password" id="edit-current-pass" class="form-control"
                            placeholder="Contrase√±a Actual">
                    </div>
                    <div class="mb-3">
                        <input type="password" id="edit-new-pass" class="form-control" placeholder="Nueva Contrase√±a">
                    </div>

                    <button class="btn-accent mt-3" onclick="updateMyProfile()">Guardar Cambios</button>
                    <div id="profile-msg" style="text-align:center;font-size:.8rem;margin-top:10px;"></div>
                </div>
            </div>

            <!-- modal de detalle del cliente -->
            <div id="detail-modal" class="modal-overlay hidden">
                <div class="panel" style="max-width:580px;width:90%;max-height:80vh;overflow-y:auto;">
                    <div class="panel-title">
                        <span>üìã Detalle del Cliente</span>
                        <button class="btn-sm-action"
                            onclick="document.getElementById('detail-modal').classList.add('hidden')">Cerrar</button>
                    </div>
                    <div id="detail-content"></div>
                </div>
            </div>

        </div>
    </div>

    <script src="app.js"></script>

</body>

</html>